Серверная часть клиент-серверного приложения онлайн игры **Rally**.    
Авторы: **студенты 4-го курса направления "Математическое обеспечение и администрирование информационных систем" РЭУ им. Г .В. Плеханова - Степаниденко Денис, Пак Матвей**.    
Выполнено в качестве работы по дисциплине **"Разработка распределенных приложений"**.  

# Правила игры
* Два гоночных болида проезжают ***трассу***, кто быстрее - побеждает.  
* ***Трасса*** представляет собой поле с генерируемыми случайным образом препятствиями.  
* Два режима игры: **MULTIPLAY** и **SINGLEPLAY.**

**Режим MULTIPLAY (игрок против игрока):**    
* 2 игрока проезжают общую трассу. Побеждает игрок, проехавший трассу за меньшее время.

**Режим SINGLEPLAY (игрок против компьютера/сервера):**   
* роль игрока-оппонента исполняет бот.  

**Управление:**  
* ArrowLeft - сместиться на соседнюю левую полосу;
* ArrowRight - сместиться на соседнюю правую полосу.

# Стек технологий
* Java: 17
* Spring Boot: 3.4.0
* Spring Boot Starter Data JDBC
* Spring Boot Starter JPA
* PostgreSQL: 42.6.0
* Project Lombok: 1.18.30
* Spring Boot Starter Test

# Архитектура БД
Использованная **СУБД - PostgreSQL**
* **USERS:** Таблица предназначается для хранения логинов и паролей пользователей
* **MULTIPLAY_STATS:** Таблица предназначается для хранения статистики игр в режиме **MULTIPLAY**
* **SINGLEPLAY_STATS:** Таблица предназначается для хранения статистики игр в режиме **SINGLEPLAY**   
Таблицы **MULTIPLAY_STATS** и **SINGLEPLAY_STATS** связаны с таблицей **USERS** при помощи внешнего ключа **user_id** 

<div align="center">
  <img src="https://github.com/user-attachments/assets/1e6ec700-edca-46f1-88b1-c929b2a5c36b" width="400" height = "400" >
</div>


# Протокол взаимодействия клиент-сервер
Протокол взаимодействия между клиентом и сервером основан на текстовых командах, передаваемых по протоколу TCP через сокеты. **Список команд:**  

### **0. Подключение к серверу/отключение от сервера:**  
* **CONNECT:** Клиент отправляет эту команду для подключения к серверу.  
* **CONNECT_ACK:** Сервер отправляет эту команду в ответ на **CONNECT**, подтверждая подключение.
***
* **DISCONNECT:** Клиент отправляет эту команду для отключения от сервера.
* **DISCONNECT_ACK:** Сервер отправляет эту команду в ответ на **DISCONNECT**, подтверждая отключение.

### **1. Регистрация/аутентификация пользователя:**  
* **USER/<*username*>:** Клиент отправляет эту команду для начала регистрации/аутентификации и отправки имени пользователя  
  (вместо <*username*> должно быть имя пользователя).
#### пояснение к *username*:
```javascript
Имя пользователя должно содержать от 5 до 20 символов, среди которых обязательно должны быть:
 - заглавная или строчная буква
 - цифра
Разрешены только буквы латинского алфавита.
```
* **USER_ACK_CREATE:** Сервер отправляет эту команду в ответ на **USER/** и требует придумать пароль.
* **USER_ACK_CHECK:** Сервер отправляет эту команду в ответ на **USER/** и требует ввести пароль.
***
* **PASS/<*password*>:** Клиент отправляет эту команду для отправки пароля пользователя  
  (вместо <*password*> должен быть пароль).
#### пояснение к *password*:
```javascript
Пароль должен содержать от 5 до 20 символов, среди которых обязательно должны быть:
 - заглавная и строчная буква
 - цифра
 - спецсимвол
Разрешены только буквы латинского алфавита.
```
* **PASS_ACK_SUCCESS:** Сервер отправляет эту команду в ответ на **PASS/** при успешной регистрации/аутентификации.
* **PASS_ACK_FAIL:** Сервер отправляет эту команду в ответ на **PASS/** при неудаче регистрации/аутентификации.
***
* **RETURN_FROM_PASSWORD:** Клиент отправляет эту команду, чтобы вернуться на начало регистрации/аутентификакации (к вводу имени пользователя).  

### **2.	Режим Multiplayer (PvP) (два игрока, каждый проезжает общую трассу, побеждает игрок с большим счетом):**  
*	**MULTIPLAY:** Клиент отправляет эту команду для перехода в режим игры против игрока (в окно выбора лобби).  
*	**MULTIPLAY_ACK_SUCCESS <*lobbies_JSON*>:** Сервер отправляет эту команду в ответ на **MULTIPLAY** если список с лобби не null  
  (<*lobbies_JSON*> - данные о лобби в формате json).
#### формат *lobbies_JSON*:
```json
[
{
  "id" : 0,
  "name_of_lobby" : "string",
  "count_of_players" : 0,
  "starting_game" : false,
  "player1" : "string",
  "player2" : "string"
},
{
  "id" : 0,
  "name_of_lobby" : "string",
  "count_of_players" : 0,
  "starting_game" : false,
  "player1" : "string",
  "player2" : "string"
}
]
```
*	**MULTIPLAY_ACK_FAIL:** Сервер отправляет эту команду в ответ на **MULTIPLAY**, если список с лобби - null.
***
*	**JOIN_LOBBY_ID/<*lobby_id*>:** Клиент отправляет эту команду для присоединения к существующему лобби по его ID  
  (вместо <*lobby_id*> должен быть id лобби).  
*	**JOIN_LOBBY_ID_ACK_SUCCESS:** Сервер отправляет эту команду в ответ на **JOIN_LOBBY_ID/** при успешном подключении к лобби.
*	**LOBBY_START_GAME:** Сервер отправляет эту команду в ответ на **JOIN_LOBBY_ID/**, когда игра в лобби уже началась.
*	**FULL_LOBBY_ERR:** Сервер отправляет эту команду в ответ на **JOIN_LOBBY_ID/**, когда лобби уже заполнено.
*	**PLAYER_JOINED:** Сервер отправляет эту команду клиенту, когда второй клиент присоединяется к его лобби.  
***
*	**READY:** Клиент отправляет эту команду, чтобы подтвердить готовность к игре
*	**LEFT_JOINED:** Сервер отправляет эту команду игроку, когда второй игрок не подтверждает готовность за выделенное время и покидает лобби.
*	**AFK_TIMEOUT:** Сервер отправляет эту команду игроку, когда этот игрок не подтвердил готовность за выделенное время.
***
*	**FINISH/<*finish_time*>:** игрок отправляет эту команду, когда доезжает до финиша  
  (<*finish_time*> - время заезда игрока)
*	**WIN/<*finish_time*>/NO>:** Сервер отправляет эту команду игроку, когда этот игрок победил, а второй игрок еще не финишировал  
  (<*finish_time*> - время заезда победителя).
*	**WIN/<*finish_time*>/<*loser_finish_time*>:** Сервер отправляет эту команду игроку, когда этот игрок победил, и второй игрок успел финишировать  
  (<*finish_time*> - время заезда победителя, <*loser_finish_time*> - время заезда проигравшего).
*	**LOSE/<*finish_time*>/<*winner_finish_time*>:** Сервер отправляет эту команду игроку, когда этот игрок проиграл  
  (<*finish_time*> - время заезда проигравшего, <*winner_finish_time*> - время заезда победителя).
*	**DRAW/<*finish_time_1*>/<*finish_time_2*>:** Сервер отправляет эту команду игроку, когда заезд завершился ничьей  
  (<*finish_time_1*> - время заезда игрока, <*finish_time_2*> - время заезда оппонента).

### **3.	Лучшие результаты:**  
*	**MULTIPLAY_TOP_SCORES_LIST_BY_WINS:** Клиент отправляет эту команду для запроса лучших результатов в режиме MULTIPLAY (количество побед).
*	**MULTIPLAY_TOP_SCORES_LIST_BY_WINS <*scores_list_JSON*>:** Сервер отправляет список лучших результатов в ответ на **MULTIPLAY_TOP_SCORES_LIST_BY_WINS**  
  (<*scores_list_JSON*> - список лучших игроков по количеству побед в режиме MULTIPLAY).
#### формат *scores_list_JSON*:
```json
[
{
  "username" : "string",
  "wins" : 0
},
{
  "username" : "string",
  "wins" : 0
}
]
```
***
*	**MULTIPLAY_TOP_SCORES_LIST_BY_TIME:** Клиент отправляет эту команду для запроса лучших результатов в режиме MULTIPLAY (лучшее время заезда).      
*	**MULTIPLAY_TOP_SCORES_LIST_BY_TIME <*scores_list_JSON*>:** Сервер отправляет список лучших результатов в ответ на **MULTIPLAY_TOP_SCORES_LIST_BY_TIME**  
  (<*scores_list_JSON*> - список лучших игроков по лучшему времени заезда в режиме MULTIPLAY).
#### формат *scores_list_JSON*:
```json
[
{
  "username" : "string",
  "best_time" : 0.0
},
{
  "username" : "string",
  "best_time" : 0.0
}
]
```

### **4.	Управление игрой:**  
*	**MOVE_LEFT:** Клиент отправляет эту команду для перемещения игрока влево.  
*	**MOVE_RIGHT:** Клиент отправляет эту команду для перемещения игрока вправо.  
